<!DOCTYPE html>
<html>
    <head>
        <title>Try</title>
        <style>
            button{
                width: 50px;
                height: 50px;
                font-size: 15;
            }
            button{
                width: 50px;
                height: 50px;
                font-size: 15;
            }

        </style>



    </head>

    <body>

        <button id="num7" onclick="
            z('7');
        ">7</button>
        <button id="num8" onclick="
            z('8');
        ">8</button>
        <button id="num9" onclick="
            z('9');
        ">9</button>
        <button id="bbh" onclick="
            z('/');
        ">/</button>
        <br/>
        <button id="num4" onclick="
            z('4');
        ">4</button>
        <button id="num5" onclick="
            z('5');
        ">5</button>
        <button id="num6" onclick="
            z('6');
        ">6</button>
        <button id="bs" onclick="
            z('*');
        ">*</button>
        <br/>
        <button id="num1" onclick="
            z('1');
        ">1</button>
        <button id="num2" onclick="
            z('2');
        ">2</button>
        <button id="num3" onclick="
            z('3');
        ">3</button>
        <button id="wko" onclick="
            z('-');
        ">-</button>
        <br/>
        <button id="num0" onclick="
            z('0');
        ">0</button>
        <button id="dot" onclick="
            z('.');
        ">.</button>
        <button id="zya" onclick="
            z('=');
        ">=</button>
        <button id="plus" onclick="
            z('+');
        ">+</button>
        
        <p class="ans"></p>
        <p class="ans2"></p>

    </body>

    <script>
        let needReset = 0;
        let alDot = 0;
        let canDot = 1;
        let isPlusZero = 1; //按『.』是否須補零
        let canCal = 0;
        let canZero = true;
        let haveSign = false;
        let beforeDot = true;
        let alreadyZero = false;
        let isFirst = true;
        let isZero = true;
        let firstIsZero = false;
        //let calTag = [];

        // document.querySelector(".ans2").innerHTML = '=' + eval('0.3-0.1*3');

        function z(w){
            
            if (!isNaN(Number(w))){ // 是數字
                let ele = document.querySelector(".ans");
                if (needReset === 1){
                    document.querySelector(".ans").innerHTML = "";
                    document.querySelector(".ans2").innerHTML = "";
                    needReset = 0;
                }
                if(w === '0'){ //0
                    if(isFirst){ //若為字首，輸出零
                        isFirst = false;
                        firstIsZero = true;
                        ele.innerHTML += String(w);
                        isPlusZero = 0;
                        canCal = 1;
                        isZero = true;
                    }else{
                        if(isZero){ //字首重複0
                            return;
                        }else{
                            ele.innerHTML += String(w);
                            isPlusZero = 0;
                            canCal = 1;
                        }
                        
                        // if (canZero){ //未有0，改變canZero後，輸出0
                        //     canZero = false;
                        //     alreadyZero = true;
                        // }else{ //已有0，不動作
                        //     return;
                        // }
                    }
                    
                }else{  //1~9
                    if(isZero && !isFirst){ //若現在零且非字首，代表輸入01
                        let tmpText = ele.innerHTML;
                        
                        ele.innerHTML = tmpText.slice(0,-1) + String(w);  //取代前一碼的0
                    }else{
                        ele.innerHTML += String(w);
                    }
                    isFirst = false;
                    isZero = false;
                    isPlusZero = 0;
                    canCal = 1;
                }
                
            }else if(w === '.'){
                if (needReset === 1){
                    document.querySelector(".ans").innerHTML = "";
                    document.querySelector(".ans2").innerHTML = "";
                    needReset = 0;
                }
                if(canDot === 1){
                    canCal = 0;
                    canDot = 0;
                    beforeDot = false;
                    canZero = true;
                    isZero = false;
                    isFirst =false;
                    if (isPlusZero === 1){
                        // 若初始或前方有運算符號時,按.自動補0
                        let ele = document.querySelector(".ans");
                        ele.innerHTML += ("0" + String(w));
                    }else{
                        let ele = document.querySelector(".ans");
                        ele.innerHTML += String(w);
                    }
                }
                
                
            }else{
                if (needReset === 1){
                    return;
                }
                if (w === '='){ // 處理字串來計算
                    let ele = document.querySelector(".ans");
                    let ansText = ele.innerHTML;
                    if ((ansText[-1] === NaN) || !haveSign){ //最後一碼為運算符號(非數字)或無運算符號時不動作
                        return;
                    }
                    document.querySelector(".ans2").innerHTML = '=' + String((Math.round(eval(ansText)*100000))/100000);
                    needReset = 1;                
                    alDot = 0;
                    canDot = 1;
                    isPlusZero = 1;
                    canCal = 0;
                    haveSign = false;
                    beforeDot = true;
                    canZero = true;
                    isFirst = true;
                    isZero = true;

                    // let ansNum = 0;
                    // for(i=0;calTag.length;i++){
                    //     let calTagIndex = ansText.search(calTag[i]);
                    //     if(i === 0){
                    //         ansNum = Number(ansText.substr(0,calTagIndex))
                    //         ansText = ansText.slice(0,calTagIndex+1);
                    //     }else{
                    //         if(calTag[i-1]==='+'){ //判斷前一運算符號
                    //             ansNum += Number(ansText.substr(0,calTagIndex));
                    //         }else if(calTag[i-1]==='-'){
                    //             ansNum -= Number(ansText.substr(0,calTagIndex));
                    //         }else if(calTag[i-1]==='*'){
                    //             ansNum *= Number(ansText.substr(0,calTagIndex));
                    //         }else if(calTag[i-1]==='/'){
                    //             ansNum /= Number(ansText.substr(0,calTagIndex));
                    //         }
                            
                    //     }
                    // }
                    
                }else if(canCal === 1) { //運算符號
                    haveSign = true;
                    canCal = 0;
                    canDot = 1;
                    isPlusZero = 1;
                    canZero = true;
                    isFirst = true;
                    isZero = true;
                    const ele = document.querySelector(".ans");
                    ele.innerHTML += String(w);
                    //calTag.push(String(w));
                    // if(w='+'){

                    // }else if(w='-'){

                    // }else if(w='*'){
                        
                    // }else if(w='/'){
                        
                    // }

                    
                }
            }

        }



    </script>


</html>

